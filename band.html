<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1000, user-scalable=yes">
    <title>Punk Archives</title>
    <style>
        /* Global Styles */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #000000;
            color: #ffffff;
        }

        /* Main flex container */
        .main-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-left: 150px; /* Matches sidebar width */
            padding-right: 150px; /* Matches sidebar width */
            padding: 20px;
        }

        /* Left Sidebar */
        .sidebar {
            width: 150px;
            background-color: #121212;
            color: #fff;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            padding: 20px 5px;
            box-sizing: border-box;
            border-right: 2px solid #660000;
        }

        .sidebar h1 {
            font-family: 'MyCustomFont2', sans-serif;
            color: #660000;
            font-size: 20px;
            text-transform: uppercase;
            margin-bottom: 20px;
            text-align: right;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
        }

        .sidebar ul li {
            margin: 15px 0;
        }

        .sidebar ul li a {
            color: #ffffff;
            text-decoration: none;
            font-size: 20px;
            display: block;
            text-align: right;
            padding: 5px;
            transition: background-color 0.2s ease-in-out;
        }

        .sidebar ul li a:hover {
            background-color: #660000;
        }

        /* Right Sidebar */
        .sidebar2 {
            width: 150px;
            background-color: #121212;
            color: #fff;
            height: 100vh;
            position: fixed;
            right: 0;
            top: 0;
            padding: 20px 5px;
            box-sizing: border-box;
            border-left: 2px solid #660000;
        }

        .sidebar2 h1 {
            font-family: 'MyCustomFont2', sans-serif;
            color: #660000;
            font-size: 20px;
            text-transform: uppercase;
            margin-bottom: 20px;
            text-align: left;
        }

        .sidebar2 ul {
            list-style: none;
            padding: 0;
        }

        .sidebar2 ul li {
            margin: 15px 0;
        }

        .sidebar2 ul li a {
            color: #ffffff;
            text-decoration: none;
            font-size: 20px;
            display: block;
            text-align: left;
            padding: 5px;
            transition: background-color 0.2s ease-in-out;
        }

        .sidebar2 ul li a:hover {
            background-color: #660000;
        }

        /* Main Content */
        .content {
            width: 100%;
            max-width: 70%;
            padding: 20px;
        }

        /* Headings */
        .content h1 {
            font-family: 'MyCustomFont2', sans-serif;
            color: #660000;
            font-size: 22px;
            text-transform: uppercase;
            border-bottom: 3px solid #660000;
            padding-bottom: 10px;
        }

        .content h2 {
            font-size: 20px;
            border-bottom: 2px solid #ffffff;
            padding-bottom: 10px;
            color: #660000;
        }

        /* News Items */
        .news-item h3 {
            font-size: 18px;
            color: #660000;
            margin: 10px 0;
        }

        .news-item p {
            line-height: 1.6;
            font-size: 16px;
        }

        /* Custom Fonts */
        @font-face {
            font-family: 'MyCustomFont';
            src: url('Modest.woff') format('woff');
        }
        @font-face {
            font-family: 'MyCustomFont2';
            src: url('Crass.ttf') format('truetype');
        }
    </style>
</head>
<body>

    <!-- Left Sidebar -->
    <div class="sidebar">
        <h1>Punk Archives</h1>
        <ul>
            <li><a href="index.html#">Home</a></li>
            <li><a href="bands.html#">All Bands</a></li>
            <li><a href="info.html#">Add Info</a></li>
            <li><a href="https://discordapp.com/users/767006494595350578">Contact</a></li>
        <ul>
            <li><a id="randomBandButton">Random Band</a></li>
        </ul>
        </ul>
    </div>

<!-- Right Sidebar -->
<div class="sidebar2">
    <div class="search-container">
        <input type="text" id="searchBar" placeholder="Search..." oninput="searchBands()">
        <ul id="searchResults" style="list-style: none; padding: 0; display: none; background: #121212; border: 1px solid #660000; position: absolute; width: 140px; max-height: 200px; overflow-y: auto;"></ul>
    </div>
</div>

<script>
const DEBUG = true; // Set to true for debugging

function searchBands() {
    const query = document.getElementById("searchBar").value.toLowerCase();
    const resultsList = document.getElementById("searchResults");

    if (query.length === 0) {
        resultsList.style.display = "none";
        return;
    }

    fetch("banddata.json")
        .then(response => response.json())
        .then(bands => {
            resultsList.innerHTML = "";
            let matches = [];

            bands.forEach(band => {
                let matchText = "";
                let priority = Infinity; // Lower is better

                function updatePriority(field, text) {
                    if (typeof field === "string") {
                        let pos = field.toLowerCase().indexOf(query);
                        if (pos !== -1 && pos < priority) {
                            priority = pos;
                            matchText = text;
                        }
                    }
                }

                updatePriority(band.band_name, `Band Name: ${band.band_name}`);
                updatePriority(band.location, `Location: ${band.location}`);

                if (Array.isArray(band.genre)) {
                    for (let g of band.genre) {
                        updatePriority(g, `Genre: ${band.genre.join(", ")}`);
                    }
                }

                if (Array.isArray(band.releases)) {
    for (let release of band.releases) {
        if (release.title) updatePriority(release.title, `Release: ${release.title}`);
        if (release.label) updatePriority(release.label, `Label: ${release.label}`);
    }
}

                if (priority !== Infinity) {
                    matches.push({ band, matchText, priority });
                }
            });

            // **Sort by priority (lower index appears first)**
            matches.sort((a, b) => a.priority - b.priority);

            if (matches.length === 0) {
                resultsList.innerHTML = "<li style='color: #888; padding: 5px;'>No results</li>";
            } else {
                matches.forEach(({ band, matchText }) => {
                    let li = document.createElement("li");
                    li.style.padding = "5px";
                    li.style.cursor = "pointer";
                    li.style.color = "#ffffff";

                    li.innerHTML = `<strong>Band:</strong> ${band.band_name}`;
                    if (matchText) {
                        li.innerHTML += `<br><span style="color: #888; font-size: 14px;">${matchText}</span>`;
                    }

                    li.onclick = function() {
                        window.location.href = `band.html?band=${encodeURIComponent(band.band_name)}`;
                    };

                    resultsList.appendChild(li);
                });
            }

            resultsList.style.display = "block";
        })
        .catch(error => console.error("Error loading band data:", error));
}
</script>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Band Content will be updated here -->
        <div id="band-content" class="content">
            <h1>Loading...</h1>
        </div>
    </div>

<style>
    /* Styling for the floating album cover */
    #album-cover {
        display: none;
        position: absolute;
        width: 200px;
        height: auto;
        border: 2px solid white;
        background: black;
        padding: 5px;
        z-index: 1000;
        pointer-events: none; /* Prevents interference with mouse movement */
    }
</style>

<style>
    /* Table for release details */
    .release-details {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 10px;
    }
    .release-details td {
        border: 1px solid white;
        padding: 5px;
        font-size: 14px;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const bandName = urlParams.get("band");

        if (!bandName) {
            document.getElementById("band-content").innerHTML = "<h1>No band selected.</h1>";
            return;
        }

        fetch("banddata.json")
            .then(response => response.json())
            .then(bands => {
                const band = bands.find(b => b.band_name === bandName);
                if (!band) {
                    document.getElementById("band-content").innerHTML = "<h1>Band not found.</h1>";
                    return;
                }

                let bandHTML = 
                    `<h1>${band.band_name}</h1>
                    <p><strong>Genres:</strong> ${band.genre.join(", ")}</p>
                    <p><strong>Location:</strong> ${band.location}</p>
                    <p><strong>Years Active:</strong> ${band.years_active}</p>
                    <p><strong>Related Bands:</strong> ${band.related_bands.join(", ")}</p>
                    <p><strong>Links:</strong></p>
                    <ul>
                        ${Object.entries(band.official_links).map(([key, url]) => `<li><a href="${url}" target="_blank">${key}</a></li>`).join("")}
                    </ul>`;

                // **Band Members Table**
                if (band.members && band.members.length > 0) {
                    bandHTML += `<hr><h2>Band Members</h2>
                    <table border="1" style="border-collapse: collapse; width: 100%; text-align: left; border: 2px #660000;">
                        <tr>
                            <th>Name</th>
                            <th>Instrument</th>
                            <th>Time Active</th>
                            <th>Status</th>
                        </tr>`;
                    band.members.forEach(member => {
                        bandHTML += `
                        <tr>
                            <td>${member.name}</td>
                            <td>${member.instrument}</td>
                            <td>${member.time_active}</td>
                            <td>${member.status}</td>
                        </tr>`;
                    });
                    bandHTML += `</table>`;
                }

                // **Discography Section**
                if (band.releases && band.releases.length > 0) {
    bandHTML += `<hr><h2>Discography</h2>`;
    band.releases.forEach((release, index) => {
        bandHTML += `
            <div style="margin-bottom: 10px;">
                <u>
                    <h3 class="release-title" data-image="${release.cover_image}" 
                        style="margin-bottom: 5px; cursor: pointer; display: inline-block;">
                        ${release.title}
                    </h3>
                </u>
                <button class="download-image" data-image="${release.cover_image}" style="margin-left: 10px;">Download Image</button>
<table class="release-details" style="border-collapse: collapse; border: 2px solid #660000;">
    <tr><td style="border: 1px solid #660000;"><strong>Label:</strong></td><td style="border: 1px solid #660000;">${release.label || "N/A"}</td></tr>
    <tr><td style="border: 1px solid #660000;"><strong>Release Date:</strong></td><td style="border: 1px solid #660000;">${release.year || "Unknown"}</td></tr>
    <tr><td style="border: 1px solid #660000;"><strong>Type:</strong></td><td style="border: 1px solid #660000;">${release.release_type || "N/A"}</td></tr>
    <tr><td style="border: 1px solid #660000;"><strong>Format:</strong></td><td style="border: 1px solid #660000;">${release.physical_format || "N/A"}</td></tr>
    <tr><td style="border: 1px solid #660000;"><strong>Limitation:</strong></td><td style="border: 1px solid #660000;">${release.limitation || "N/A"}</td></tr>
    <tr><td style="border: 1px solid #660000;"><strong>Extra Info:</strong></td><td style="border: 1px solid #660000;">${release.extra_info || "N/A"}</td></tr>
</table>

                
                <!-- Collapsible Tracklist -->
                <button class="toggle-tracks" data-index="${index}" 
                    style="display: block; margin-top: 5px; background: black; color: white; border: 1px solid red; padding: 5px;">
                    Show Tracklist
                </button>
                <ol class="tracklist" id="tracklist-${index}" 
                    style="display: none; margin-top: 5px; padding-left: 20px;">
                    ${release.tracks.map(track => `<li>${track}</li>`).join("")}
                </ol>
            </div>`;
    });
}

setTimeout(() => {
    document.querySelectorAll(".toggle-tracks").forEach(button => {
        button.addEventListener("click", function () {
            const index = this.getAttribute("data-index");
            const tracklist = document.getElementById(`tracklist-${index}`);
            if (tracklist.style.display === "none") {
                tracklist.style.display = "block";
                this.textContent = "Hide Tracklist";
            } else {
                tracklist.style.display = "none";
                this.textContent = "Show Tracklist";
            }
        });
    });
}, 100);

                document.getElementById("band-content").innerHTML = bandHTML;

                // **Album Cover Hover Feature**
                const albumCover = document.createElement("img");
                albumCover.id = "album-cover";
                albumCover.style.position = "absolute";
                albumCover.style.width = "200px";
                albumCover.style.border = "2px solid white";
                albumCover.style.display = "none";
                albumCover.style.background = "black";
                albumCover.style.padding = "5px";
                albumCover.style.zIndex = "1000";
                albumCover.style.pointerEvents = "none";
                document.body.appendChild(albumCover);

                document.querySelectorAll(".release-title").forEach(title => {
                    title.addEventListener("mouseover", function (event) {
                        const imageUrl = this.getAttribute("data-image");
                        if (imageUrl) {
                            albumCover.src = imageUrl;
                            albumCover.style.display = "block";
                        }
                    });

                    title.addEventListener("mousemove", function (event) {
                        albumCover.style.top = `${event.pageY + 10}px`;
                        albumCover.style.left = `${event.pageX + 10}px`;
                    });

                    title.addEventListener("mouseleave", function () {
                        albumCover.style.display = "none";
                    });
                });

                // **Download Image Feature**
                document.querySelectorAll(".download-image").forEach(button => {
                    button.addEventListener("click", function () {
                        const imageUrl = this.getAttribute("data-image");
                        if (imageUrl) {
                            const link = document.createElement("a");
                            link.href = imageUrl;
                            link.download = imageUrl.split("/").pop();
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        }
                    });
                });

                // **Extra Images Carousel Feature**
                if (band.extra_images && band.extra_images.length > 0) {
                    let currentImageIndex = 0;

                    document.getElementById("image-carousel").style.display = "block";
                    document.getElementById("carousel-image").src = band.extra_images[currentImageIndex];

                    document.getElementById("prev-image").addEventListener("click", function () {
                        currentImageIndex = (currentImageIndex - 1 + band.extra_images.length) % band.extra_images.length;
                        document.getElementById("carousel-image").src = band.extra_images[currentImageIndex];
                    });

                    document.getElementById("next-image").addEventListener("click", function () {
                        currentImageIndex = (currentImageIndex + 1) % band.extra_images.length;
                        document.getElementById("carousel-image").src = band.extra_images[currentImageIndex];
                    });
                }
            })
            .catch(error => console.error("Error loading band data:", error));
    });
</script>


<center><p>Is this page incomplete? Help by submitting info.</p></center>

<script>
document.getElementById("randomBandButton").addEventListener("click", function () {
    fetch("banddata.json")
        .then(response => response.json())
        .then(bands => {
            if (bands.length === 0) {
                alert("No bands available.");
                return;
            }
            const randomBand = bands[Math.floor(Math.random() * bands.length)];
            window.location.href = `band.html?band=${encodeURIComponent(randomBand.band_name)}`;
        })
        .catch(error => console.error("Error loading band data:", error));
});
</script>


</body>
</html>
